<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0,user-scalable=no" name="viewport" id="viewport" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="format-detection" content="telephone=no" />
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/luck.css"/>
</head>
<body>
  <!-- 转盘 -->
  <section class="turntable">
    <div class="zhuanpan turnplate">
      <img class="pointer" src="__PUBLIC__/Admin/images/start.png"/>
      <canvas class="item" id="wheelcanvas" width="422px" height="422px"></canvas>      
    </div>
    <img src="__PUBLIC__/Admin/images/xiecheng.png" id="xiecheng-img" style="display:none;" />
    <img src="__PUBLIC__/Admin/images/jingdong.png" id="jingdong-img" style="display:none;" />
    <img src="__PUBLIC__/Admin/images/iqiyi.png" id="iqiyi-img" style="display:none;" />
    <img src="__PUBLIC__/Admin/images/chongzhi.png" id="chongzhi-img" style="display:none;" />
    <img src="__PUBLIC__/Admin/images/liuliang.png" id="liuliang-img" style="display:none;" />
    <div class="present"></div>
  </section> 
  <section class="jilu">
    <!-- 中奖纪录 -->
    <div class="zjjl">
      <h3 class="jiluTitle"></h3>
      <div class="jiluContent">
        <div class="jiluInfo" id="jiluInfo">
          <div class="jiluInfoIn">
            <ul id="top">
              <li>
                <span class="zhongjiangMobile">137****2345</span>
                <span class="jiangpin">手机流量100MB</span>
              </li>
              <li>
                <span class="zhongjiangMobile">155****2842</span>
                <span class="jiangpin">手机流量100MB</span>
              </li>
              <li>
                <span class="zhongjiangMobile">137****2345</span>
                <span class="jiangpin">抽中小米手机5</span>
              </li>
              <li>

                <span class="zhongjiangMobile">155****2842</span>
                <span class="jiangpin">爱奇艺会员3个月</span>
              </li>
              <li>
                <span class="zhongjiangMobile">137****2345</span>
                <span class="jiangpin">捷波朗蓝牙耳机</span>
              </li>
              <li>
                <span class="zhongjiangMobile">155****2842</span>
                <span class="jiangpin">30元话费充值</span>
              </li>
              <li>
                <span class="zhongjiangMobile">137****2345</span>
                <span class="jiangpin">手机流量100MB</span>
              </li>
              <li>
                <span class="zhongjiangMobile">137****2345</span>
                <span class="jiangpin">抽中小米手机5</span>
              </li>
              <li>
                <span class="zhongjiangMobile">155****2842</span>
                <span class="jiangpin">爱奇艺会员3个月</span>
              </li>
              <li>
                <span class="zhongjiangMobile">155****2842</span>
                <span class="jiangpin">爱奇艺会员3个月</span>
              </li>
            </ul>
            <ul id="bottom"></ul>  
          </div>      
        </div>
      </div>
    </div>
    <!-- 活动规则说明 -->
    <div class="desc">
      <h3 class="jiluTitle changeBg"></h3>
      <div class="descInfo">
        <ul>
          <li>1、点击“开始”按钮抽奖，每人一次抽奖机会；</li>
          <li>2、转盘停止后箭头所指区域为客户所中奖项；</li>
          <li>3、若您抽中一、二等奖，请点击领奖，待系统提示领奖信息提交成功后5个工作日内会有专人与您联系；</li>
          <li>4、若您抽中三、四、五等奖，请点击领奖并填写相关信息进行领奖。</li>
        </ul>
      </div>
    </div>
    <!-- 免责声明 -->
    <div class="shengming">
      <h3 class="smTitle">免责声明</h3>
      <ul class="smContent">
        <li>1、瀚亚资本保留对本抽奖活动规则中条款修订及最终解释的权利。</li>
        <li>2、抽奖仅限在预约成功页面参与，若放弃抽奖不保留抽奖机会，不提供其他抽奖入口。</li>
        <li>3、所有奖品信息均来自合作方，其真实性、准确性和合法性由信息拥有者（合作方）负责，瀚亚资本不提供任何保证，并不承担任何法律责任。商品以实物为准。</li>
      </ul>
    </div>
  </section>
  <!-- 中奖提示 -->
  <div class="black" id="black"></div>
  <div class="remindInfo" id="remindInfo">
    <span class="awardInfo"></span>
    <p class="jiangpinTitle">获得手机流量100MB</p>
    <button class="getaward">点击领奖</button>
  </div>

  <!-- 手机充值 -->
  <div class="bill"  style="display: none">
    <div class="billTitle">领取奖励</div>
    <form action="" method="" id="awardform">
      <input type="tel" name="phoneNumm" placeholder="请输入您的手机号码" required pattern="1[3|5|7|8|4][0-9]{9}" class="phoneNumm" />
      <p class="get_award"><input type="button" value="立即兑换" class="getButton"/></p>
    </form>
  </div>
  <div class="tip"  style="display: none" style="box-shadow: 0 0 13px 0px rgba(000,000,000,0.3)">
	  <div class="billTitle">提示</div>
	  <p class="remindWord">奖品兑换成功，请注意查收，如有问题请致电<a href="tel:4006510011">400-651-0011</a></p>
	  <p class="get_award"><input type="button" value="确定" class="ok"/></p>
  </div>
</body>
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/js/awardRotate.js"></script>
<script src="__PUBLIC__/Admin/js/jquery-html5Validate.js" type="text/javascript"></script>

<script type="text/javascript"> 
$(function(){
       $(".getButton").bind("click", function() {
        var right=$("#awardform");

        if ($.html5Validate.isAllpass(right)) {
          var tel = $('.phoneNumm').val();
          var type = $(".jiangpinTitle").html();
		  if (type == '获得手机流量100MB'){
	          $.ajax({
	            async:false,
	            type:"post",
	            url:"{:U('Luck/liuliang')}",
	            data:{'tel':tel},
	            dataType:"json",
	            success:function(result){
	            	$('.remindWord').html(result);
	            	$('.bill').hide();
	            	$('.tip').show();
	            }
	          })
		  }
		  else if (type == '获得30元话费充值'){
			  $.ajax({
	            async:false,
	            type:"post",
	            url:"{:U('Luck/huafei')}",
	            data:{'tel':tel},
	            dataType:"json",
	            success:function(result){
	            	$('.remindWord').html(result);
	            	$('.bill').hide();
	            	$('.tip').show();
	            }
	          })
		  }
		  else {
			  $('.remindWord').html('这是不可能事件，重新抽吧啊！');
        $('.bill').hide();
        $('.tip').show();
		  }
        }
    })
    $(".ok").bind("click", function() {
      location.href = 'http://www.baidu.com';
    	$('.tip').hide();
    	$('.black').hide();
    })
       $.fn.immediValidate = function(passCallback) {
        return $(this).find(":input").each(function() {
            if (/^submit|image|reset|file|radio|checkbox|button$/.test(this.type)) return;
            var self = this;
            $(this).bind("blur", function() {
                setTimeout(function() {
                    if ($.testRemind.display == false && $.html5Validate.isAllpass($(self))   ) {
                     $.isFunction(passCallback) && passCallback.call(self);
                 }
             }, 100);
            });

        });

    };
    $("#awardform").html5Validate().immediValidate();

    $("form").html5Validate(function() {

    }, {
       validate: function() {
        // 下面这些就是额外的一些特殊验证

    }

});





 
 var turnplate={
    restaraunts:[],       //大转盘奖品名称
    colors:[],          //大转盘奖品区块对应背景颜色
    outsideRadius:192,      //大转盘外圆的半径
    textRadius:155,       //大转盘奖品位置距离圆心的距离
    insideRadius:0,      //大转盘内圆的半径
    startAngle:0,       //开始角度
    
    bRotate:false       //false:停止;ture:旋转
  };

  $(document).ready(function(){
  //动态添加大转盘的奖品与奖品区域背景颜色
  turnplate.restaraunts = ["携程礼品卡","京东E卡","爱奇艺会员3个月","30元话费充值","手机流量100MB"];
  turnplate.colors = ["#ddfeff","#ffffdd","#dde9ff","#ddfff0","#ffdde8"];  
  var rotateTimeOut = function (){
    $('#wheelcanvas').rotate({
      angle:0,
      animateTo:2160,
      duration:8000,
      callback:function (){
        alert('网络超时，请检查您的网络设置！');
      }
    });
  };

  //旋转转盘 item:奖品位置; txt：提示语;
  var rotateFn = function (item, txt){
    var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length*2));
    if(angles<270){
      angles = 270 - angles; 
    }else{
      angles = 360 - angles + 270;
    }
    $('#wheelcanvas').stopRotate();
    $('#wheelcanvas').rotate({
      angle:0,
      animateTo:angles+1800,
      duration:8000,
      callback:function (){
       $("#black").show();
       $("#remindInfo").show();
       $(".jiangpinTitle").html('获得'+txt);
       turnplate.bRotate = !turnplate.bRotate;
       var getVal=$(".jiangpinTitle").html();
       var getImg=$('.awardInfo');
       switch(getVal){
         case '获得携程礼品卡':
         getImg.css('background-image','url(__PUBLIC__/Admin/images/xiecheng.png)');
         break;
         case '获得京东E卡':
         getImg.css('background-image','url(__PUBLIC__/Admin/images/jingdong.png)');
         break;
         case '获得爱奇艺会员3个月':
         getImg.css('background-image','url(__PUBLIC__/Admin/images/iqiyi.png)');
         break;
         case '获得30元话费充值':
         getImg.css('background-image','url(__PUBLIC__/Admin/images/chongzhi.png)');
         break;
         case '获得手机流量100MB':
         getImg.css('background-image','url(__PUBLIC__/Admin/images/liuliang.png)');
         break;
       }
	   <!--充值-->
       $('.getaward').on('click',function(){
        $("#remindInfo").hide();
        var awardName=$('.jiangpinTitle').text();
        if(awardName=='获得30元话费充值'){
          $(".bill").show();
        }
        else if(awardName=='获得手机流量100MB'){
          $(".bill").show();
        }
        else if(awardName=='获得爱奇艺会员3个月'){
          $(".bill").show();
        }
        else if(awardName=='获得京东E卡'){
          $(".bill").show();
        }
        else if(awardName=='获得携程礼品卡'){
          $(".bill").show();
        }
        else{ 
          $('.black').hide()
        }



      })
     }
   });
};

$('.pointer').click(function (){
  if(turnplate.bRotate)return;
  turnplate.bRotate = !turnplate.bRotate;
    //获取随机数(奖品个数范围内)
    var item = rnd(1,10000);
    // 奖品数量等于10,指针落在对应奖品区域的中心角度[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]
    if (item <= 50) {
      rotateFn(1, turnplate.restaraunts[0]);
    }else if (item > 50 && item <= 150) {
      rotateFn(2, turnplate.restaraunts[1]);
    }else if (item > 150 && item <= 650) {
      rotateFn(3, turnplate.restaraunts[2]);
    }else if (item > 650 && item <= 2650){
      rotateFn(4, turnplate.restaraunts[3]);
    }else{
      rotateFn(5, turnplate.restaraunts[4]);
    }

    // 这是原来的代码
    // rotateFn(item, turnplate.restaraunts[item-1]);
    /* switch (item) {
      case 1:
        rotateFn(252, turnplate.restaraunts[0]);
        break;
      case 2:
        rotateFn(216, turnplate.restaraunts[1]);
        break;
      case 3:
        rotateFn(180, turnplate.restaraunts[2]);
        break;
      case 4:
        rotateFn(144, turnplate.restaraunts[3]);
        break;
      case 5:
        rotateFn(108, turnplate.restaraunts[4]);
        break;
      case 6:
        rotateFn(72, turnplate.restaraunts[5]);
        break;
      case 7:
        rotateFn(36, turnplate.restaraunts[6]);
        break;
      case 8:
        rotateFn(360, turnplate.restaraunts[7]);
        break;
      case 9:
        rotateFn(324, turnplate.restaraunts[8]);
        break;
      case 10:
        rotateFn(288, turnplate.restaraunts[9]);
        break;
      } */
      console.log(item);
    });
});


function rnd(n, m){
  var random = Math.floor(Math.random()*(m-n+1)+n);
  return random;
  
}


//页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
window.onload=function(){
  drawRouletteWheel();

  <!--中奖纪录滚动-->
  var top=document.getElementById("top");
  var bottom=document.getElementById("bottom");
  var jiluInfo=document.getElementById("jiluInfo");
  bottom.innerHTML=top.innerHTML;
  var time=setInterval(fun,20);
  function fun()
  {
    if(top.offsetHeight-jiluInfo.scrollTop<=0)
    {
      jiluInfo.scrollTop=0;
    }
    else
    {
      jiluInfo.scrollTop++;
    }
  }
};

function drawRouletteWheel() {    
  var canvas = document.getElementById("wheelcanvas");    
  if (canvas.getContext) {
    //根据奖品个数计算圆周角度
    var arc = Math.PI / (turnplate.restaraunts.length/2);
    var ctx = canvas.getContext("2d");
    //在给定矩形内清空一个矩形
    ctx.clearRect(0,0,422,422);
    //strokeStyle 属性设置或返回用于笔触的颜色、渐变或模式  
    ctx.strokeStyle = "#FFBE04";
    //font 属性设置或返回画布上文本内容的当前字体属性
    ctx.font = '18px Microsoft YaHei';      
    for(var i = 0; i < turnplate.restaraunts.length; i++) {       
      var angle = turnplate.startAngle + i * arc;
      ctx.fillStyle = turnplate.colors[i];
      ctx.beginPath();
      //arc(x,y,r,起始角,结束角,绘制方向) 方法创建弧/曲线（用于创建圆或部分圆）    
      ctx.arc(211, 211, turnplate.outsideRadius, angle, angle + arc, false);    
      ctx.arc(211, 211, turnplate.insideRadius, angle + arc, angle, true);
      ctx.stroke();  
      ctx.fill();
      //锁画布(为了保存之前的画布状态)
      ctx.save();   
      
      //----绘制奖品开始----
      ctx.fillStyle = "#790600";
      var text = turnplate.restaraunts[i];
      var line_height = 17;
      //translate方法重新映射画布上的 (0,0) 位置
      ctx.translate(211 + Math.cos(angle + arc / 2) * turnplate.textRadius, 211 + Math.sin(angle + arc / 2) * turnplate.textRadius);
      
      //rotate方法旋转当前的绘图
      ctx.rotate(angle + arc / 2 + Math.PI / 2);
      
      /** 下面代码根据奖品类型、奖品名称长度渲染不同效果，如字体、颜色、图片效果。(具体根据实际情况改变) **/
      if(text.indexOf("x")>0){
        //流量包
        var texts = text.split("M");
        for(var j = 0; j<texts.length; j++){
          ctx.font = j == 0?'17px Microsoft YaHei':'17px Microsoft YaHei';
          if(j == 0){
            ctx.fillText(texts[j]+"M", -ctx.measureText(texts[j]+"M").width / 2, j * line_height);
          }else{
            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
          }
        }
      }else if(text.indexOf("M") == -1 && text.length>9){
        //奖品名称长度超过一定范围 
        text = text.substring(0,9)+"||"+text.substring(9);
        var texts = text.split("||");
        for(var j = 0; j<texts.length; j++){
          ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
        }
      }else{
        //在画布上绘制填色的文本。文本的默认颜色是黑色
        //measureText()方法返回包含一个对象，该对象包含以像素计的指定字体宽度
        ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      }
      
      //添加对应图标
      if(text.indexOf("携程礼品卡")>=0){
        var img= document.getElementById("xiecheng-img");
        img.onload=function(){  
          ctx.drawImage(img,-40,15,82,86);      
        }; 
        ctx.drawImage(img,-40,15,82,86);  
      }
      else if(text.indexOf("京东E卡")>=0){
        var img= document.getElementById("jingdong-img");
        img.onload=function(){  
          ctx.drawImage(img,-30,15,82,86);      
        };  
        ctx.drawImage(img,-30,15,82,86);  
      }
      else if(text.indexOf("爱奇艺会员3个月")>=0){
        var img= document.getElementById("iqiyi-img");
        img.onload=function(){  
          ctx.drawImage(img,-42,12,82,86);      
        };  
        ctx.drawImage(img,-42,12,82,86);  
      }
      else if(text.indexOf("30元话费充值")>=0){
        var img= document.getElementById("chongzhi-img");
        img.onload=function(){  
          ctx.drawImage(img,-42,10,82,86);     
        };  
        ctx.drawImage(img,-42,10,82,86);  
      }
      else if(text.indexOf("手机流量100MB")>=0){
        var img= document.getElementById("liuliang-img");
        img.onload=function(){  
          ctx.drawImage(img,-40,11,83,87);      
        };  
        ctx.drawImage(img,-40,11,83,87);  
      }


      //把当前画布返回（调整）到上一个save()状态之前 
      ctx.restore();
      //----绘制奖品结束----
    }     
  } 



}

})
      



 </script>
</html>